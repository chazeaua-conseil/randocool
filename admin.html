<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ajouter une Marche - Randocool</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root { --primary: #27ae60; --dark: #2d3436; --bg: #f4f7f6; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); padding: 20px; }
        .container { max-width: 600px; margin: 0 auto; background: white; padding: 30px; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        h1 { text-align: center; color: var(--dark); margin-bottom: 30px; }
        
        .form-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; font-weight: bold; color: #555; }
        input, textarea, select { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 1em; }
        
        /* Style pour les champs c√¥te √† c√¥te */
        .row { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        
        button { width: 100%; padding: 15px; background: var(--primary); color: white; border: none; border-radius: 8px; font-size: 1.1em; font-weight: bold; cursor: pointer; transition: background 0.3s; margin-top: 10px; }
        button:hover { background: #219150; }
        
        #message { margin-top: 20px; padding: 15px; border-radius: 8px; display: none; text-align: center; font-weight: bold; }
        .success { background: #d4edda; color: #155724; display: block !important; }
        .error { background: #f8d7da; color: #721c24; display: block !important; }
    </style>
</head>
<body>

    <div class="container">
        <div style="margin-bottom: 20px;"><a href="index.html" style="text-decoration: none; color: var(--primary); font-weight: bold;">‚Üê Retour au Journal</a></div>
        <h1>‚ûï Nouvelle Marche</h1>
        
        <form id="rando-form">
            <div class="form-group">
                <label for="titre">Titre de la randonn√©e</label>
                <input type="text" id="titre" placeholder="Ex: Cr√™tes du Tanet" required>
            </div>

            <div class="row">
                <div class="form-group">
                    <label for="date">Date</label>
                    <input type="date" id="date" required>
                </div>
                <div class="form-group">
                    <label for="difficulte">‚õ∞Ô∏è Difficult√©</label>
                    <select id="difficulte">
                        <option value="Facile">Facile</option>
                        <option value="Moyen" selected>Moyen</option>
                        <option value="Difficile">Difficile</option>
                        <option value="Expert">Expert</option>
                    </select>
                </div>
            </div>

            <div class="row">
                <div class="form-group">
                    <label for="distance">üìè Distance (km)</label>
                    <input type="number" id="distance" step="any" placeholder="ex: 12.5">
                </div>
                <div class="form-group">
                    <label for="denivele">üßó D√©nivel√© (m)</label>
                    <input type="number" id="denivele" placeholder="ex: 450">
                </div>
            </div>

            <div class="form-group">
                <label for="description">üìù Description / R√©sum√©</label>
                <textarea id="description" style="height: 120px;" placeholder="Racontez la sortie..."></textarea>
            </div>

            <div class="form-group">
                <label for="image_url">üñºÔ∏è URL de l'image (Couverture)</label>
                <input type="url" id="image_url" placeholder="https://...">
            </div>

            <div class="form-group">
                <label for="album_url">üì∑ URL de l'album Photos</label>
                <input type="url" id="album_url" placeholder="Lien Google Photos...">
            </div>

            <button type="submit" id="submit-btn">Enregistrer la randonn√©e</button>
        </form>

        <div id="message"></div>
    </div>

    <script>
			const SUPABASE_URL = 'https://mdpzwevznroqkpnobbag.supabase.co';
			const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1kcHp3ZXZ6bnJvcWtwbm9iYmFnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg3OTM1MjEsImV4cCI6MjA4NDM2OTUyMX0.ISXEl1Lf-jKMW1BUKnu02wcjs1veZ9Os9kmJcJCmwG4';
			const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        const form = document.getElementById('rando-form');
        const msgDiv = document.getElementById('message');
        const btn = document.getElementById('submit-btn');

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            btn.disabled = true;
            btn.innerText = "Enregistrement en cours...";

            const nouvelleRando = {
                titre: document.getElementById('titre').value,
                date: document.getElementById('date').value,
                difficulte: document.getElementById('difficulte').value,
                distance: document.getElementById('distance').value ? parseFloat(document.getElementById('distance').value) : null,
                denivele: document.getElementById('denivele').value ? parseInt(document.getElementById('denivele').value) : null,
                description: document.getElementById('description').value,
                image_url: document.getElementById('image_url').value,
                album_url: document.getElementById('album_url').value
            };

            const { error } = await supabaseClient
                .from('randos')
                .insert([nouvelleRando]);

            if (error) {
                msgDiv.innerText = "Erreur : " + error.message;
                msgDiv.className = "error";
                btn.disabled = false;
                btn.innerText = "R√©essayer";
            } else {
                msgDiv.innerText = "‚úÖ Marche ajout√©e avec succ√®s !";
                msgDiv.className = "success";
                form.reset();
                setTimeout(() => { window.location.href = "index.html"; }, 1500);
            }
        });
    </script>
</body>
</html>